<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Runtime Debugging</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px 5px;
        }
        .btn:hover { background: #0056b3; }
        .success-box {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin: 15px 0;
        }
        .error-box {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
            margin: 15px 0;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Railway Runtime Debugging</h1>
        
        <div class="success-box">
            <h3>‚úÖ Build Status: SUCCESS</h3>
            <p><strong>Build completed successfully</strong> in 28.51 seconds</p>
            <p><strong>Issue:</strong> Build works, but runtime is failing</p>
        </div>

        <div class="error-box">
            <h3>‚ùå Common Railway Runtime Issues</h3>
            <p>Your build succeeded but the app is failing to start. Here are the most likely causes:</p>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #1: Missing ant-bridge-server.js File</h3>
            <p><strong>Most Likely Cause:</strong> Railway built successfully but can't find the main file.</p>
            
            <div class="code-block">
# Nixpacks detected start command:
start: node ant-bridge-server.js

# But the file might not exist in your repository
            </div>
            
            <div class="warning-box">
                <strong>Check:</strong> Do you have <code>ant-bridge-server.js</code> in your GitHub repository root?
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #2: File Path/Name Mismatch</h3>
            <p>Railway tries to start <code>node ant-bridge-server.js</code> but the file has a different name.</p>
            
            <div class="warning-box">
                <strong>Common mismatches:</strong>
                <ul>
                    <li>File is named <code>server.js</code> instead of <code>ant-bridge-server.js</code></li>
                    <li>File is in a subdirectory like <code>src/ant-bridge-server.js</code></li>
                    <li>File has different capitalization</li>
                </ul>
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #3: Runtime Dependencies Missing</h3>
            <p>The app starts but crashes immediately due to missing dependencies.</p>
            
            <div class="code-block">
# Common runtime errors:
Error: Cannot find module 'ws'
Error: Cannot find module 'child_process'
Process exited with code 1
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #4: Port Binding Problems</h3>
            <p>App starts but fails to bind to Railway's assigned port.</p>
            
            <div class="code-block">
# Runtime error examples:
Error: listen EADDRINUSE :::8888
Error: Port 8888 is already in use
EACCES: permission denied, listen on port 8888
            </div>
        </div>

        <h2>üõ†Ô∏è Debug Steps</h2>

        <div class="debug-section">
            <h3>Step 1: Check Railway Runtime Logs</h3>
            <p>In Railway dashboard:</p>
            <ol>
                <li>Go to your service (web-production-f8ebc)</li>
                <li>Click on the most recent deployment</li>
                <li>Look for <strong>"Deploy Logs"</strong> tab</li>
                <li>Scroll down to see <strong>runtime logs</strong> (after build)</li>
            </ol>
            
            <div class="warning-box">
                <strong>Look for:</strong> Error messages that appear AFTER "Successfully Built!"
            </div>
        </div>

        <div class="debug-section">
            <h3>Step 2: Verify File Structure</h3>
            <p>Check your GitHub repository has these files:</p>
            
            <div class="code-block">
repository-root/
‚îú‚îÄ‚îÄ ant-bridge-server.js  ‚Üê Main file (MUST exist)
‚îú‚îÄ‚îÄ package.json          ‚Üê With correct start script
‚îú‚îÄ‚îÄ Procfile              ‚Üê Optional: web: node ant-bridge-server.js
‚îî‚îÄ‚îÄ railway.json          ‚Üê Optional: Config file
            </div>
            
            <button class="btn" onclick="checkGitHubRepo()">üîç Check GitHub Repository</button>
        </div>

        <div class="debug-section">
            <h3>Step 3: Quick Fix - Create Minimal Server</h3>
            <p>If the file is missing, here's a minimal working server:</p>
            
            <div class="code-block">
// ant-bridge-server.js - Minimal Railway Test
const http = require('http');
const WebSocket = require('ws');

const port = process.env.PORT || 8888;

// Create HTTP server first
const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Railway ANT+ Bridge Server Running\\n');
});

// Create WebSocket server
const wss = new WebSocket.Server({ server });

wss.on('connection', (ws) => {
    console.log('Client connected');
    ws.send(JSON.stringify({
        type: 'status',
        message: 'Railway ANT+ Bridge Connected',
        platform: 'railway'
    }));
});

server.listen(port, '0.0.0.0', () => {
    console.log(`üöÇ Railway server running on port ${port}`);
});
            </div>
            
            <button class="btn" onclick="downloadMinimalServer()">üì• Download Minimal Server</button>
        </div>

        <div class="debug-section">
            <h3>Step 4: Test Connection</h3>
            <p>After fixing and redeploying, test the connection:</p>
            
            <button class="btn" onclick="testConnection()">üß™ Test Railway Connection</button>
            <div id="test-results"></div>
        </div>

        <div class="error-box">
            <h3>üö® Most Likely Issue</h3>
            <p><strong>Your <code>ant-bridge-server.js</code> file is missing from the GitHub repository.</strong></p>
            <p>Railway built successfully because it found <code>package.json</code>, but when it tries to start with <code>node ant-bridge-server.js</code>, the file doesn't exist.</p>
            
            <h4>Quick Fix:</h4>
            <ol>
                <li>Download the minimal server above</li>
                <li>Add it to your GitHub repository as <code>ant-bridge-server.js</code></li>
                <li>Commit and push to trigger redeploy</li>
            </ol>
        </div>

        <div class="warning-box">
            <h3>üìã Next Steps</h3>
            <ol>
                <li><strong>Check Railway deploy logs</strong> for runtime errors</li>
                <li><strong>Verify ant-bridge-server.js exists</strong> in your GitHub repo</li>
                <li><strong>Add minimal server</strong> if file is missing</li>
                <li><strong>Test connection</strong> after redeploy</li>
            </ol>
        </div>
    </div>

    <script>
        function checkGitHubRepo() {
            // Open GitHub repository in new tab
            const repoUrl = 'https://github.com/divergentinc2021/ANTicP';
            window.open(repoUrl, '_blank');
            
            alert('Check if ant-bridge-server.js exists in your repository root');
        }

        function downloadMinimalServer() {
            const serverCode = `// ant-bridge-server.js - Minimal Railway Server
const http = require('http');
const WebSocket = require('ws');

const port = process.env.PORT || 8888;

console.log('üöÇ Starting Railway ANT+ Bridge...');
console.log(\`Port: \${port}\`);

// Create HTTP server first (Railway needs this)
const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Railway ANT+ Bridge Server Running\\n' + new Date().toISOString());
});

// Create WebSocket server on the same port
const wss = new WebSocket.Server({ server });

console.log('WebSocket server created');

wss.on('connection', (ws, req) => {
    const clientIP = req.headers['x-forwarded-for'] || req.connection.remoteAddress;
    console.log(\`üîå Client connected from \${clientIP}\`);
    
    // Send welcome message
    ws.send(JSON.stringify({
        type: 'status',
        message: 'Connected to Railway ANT+ Bridge',
        platform: 'railway',
        timestamp: Date.now()
    }));
    
    // Handle messages
    ws.on('message', (data) => {
        try {
            const message = JSON.parse(data);
            console.log('üì® Received:', message.type);
            
            // Echo back with Railway info
            ws.send(JSON.stringify({
                type: 'response',
                original: message,
                platform: 'railway',
                status: 'received'
            }));
        } catch (error) {
            console.error('‚ùå Message error:', error);
        }
    });
    
    ws.on('close', () => {
        console.log('üîå Client disconnected');
    });
    
    ws.on('error', (error) => {
        console.error('‚ùå WebSocket error:', error);
    });
});

wss.on('error', (error) => {
    console.error('‚ùå WebSocket server error:', error);
});

// Start server
server.listen(port, '0.0.0.0', () => {
    console.log(\`‚úÖ Railway server running on port \${port}\`);
    console.log(\`üåê HTTP: http://0.0.0.0:\${port}\`);
    console.log(\`üîå WebSocket: ws://0.0.0.0:\${port}\`);
    console.log('üöÇ Railway deployment successful!');
});

// Handle Railway shutdown signals
process.on('SIGTERM', () => {
    console.log('üõë SIGTERM received, shutting down gracefully');
    server.close(() => {
        console.log('‚úÖ Server closed');
        process.exit(0);
    });
});

process.on('SIGINT', () => {
    console.log('üõë SIGINT received, shutting down gracefully');
    server.close(() => {
        console.log('‚úÖ Server closed');
        process.exit(0);
    });
});`;

            // Download the file
            const blob = new Blob([serverCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ant-bridge-server.js';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Downloaded minimal ant-bridge-server.js\\n\\nAdd this to your GitHub repository and push to trigger redeploy');
        }

        async function testConnection() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>üîç Testing Railway connection...</p>';

            try {
                // Test HTTP first
                const httpResponse = await fetch('https://web-production-f8ebc.up.railway.app', { 
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                // Test WebSocket
                const ws = new WebSocket('wss://web-production-f8ebc.up.railway.app');
                
                const timeout = setTimeout(() => {
                    ws.close();
                    resultsDiv.innerHTML = '<div style="background: #fff3cd; padding: 10px; border-radius: 5px;">‚ùå WebSocket timeout - Server may not be running</div>';
                }, 10000);

                ws.onopen = () => {
                    clearTimeout(timeout);
                    resultsDiv.innerHTML = '<div style="background: #d4edda; padding: 10px; border-radius: 5px;">‚úÖ Connection successful! Railway server is working</div>';
                    ws.close();
                };

                ws.onerror = () => {
                    clearTimeout(timeout);
                    resultsDiv.innerHTML = '<div style="background: #f8d7da; padding: 10px; border-radius: 5px;">‚ùå Connection failed - Check Railway deployment logs</div>';
                };

            } catch (error) {
                resultsDiv.innerHTML = \`<div style="background: #f8d7da; padding: 10px; border-radius: 5px;">‚ùå Test failed: \${error.message}</div>\`;
            }
        }
    </script>
</body>
</html>`;

<function_calls>
<invoke name="vscode-mcp-server:create_file_code">
<parameter name="content"><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Runtime Debugging</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px 5px;
        }
        .btn:hover { background: #0056b3; }
        .success-box {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin: 15px 0;
        }
        .error-box {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
            margin: 15px 0;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Railway Runtime Debugging</h1>
        
        <div class="success-box">
            <h3>‚úÖ Build Status: SUCCESS</h3>
            <p><strong>Build completed successfully</strong> in 28.51 seconds</p>
            <p><strong>Issue:</strong> Build works, but runtime is failing</p>
        </div>

        <div class="error-box">
            <h3>‚ùå Common Railway Runtime Issues</h3>
            <p>Your build succeeded but the app is failing to start. Here are the most likely causes:</p>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #1: Missing ant-bridge-server.js File</h3>
            <p><strong>Most Likely Cause:</strong> Railway built successfully but can't find the main file.</p>
            
            <div class="code-block">
# Nixpacks detected start command:
start: node ant-bridge-server.js

# But the file might not exist in your repository
            </div>
            
            <div class="warning-box">
                <strong>Check:</strong> Do you have <code>ant-bridge-server.js</code> in your GitHub repository root?
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #2: File Path/Name Mismatch</h3>
            <p>Railway tries to start <code>node ant-bridge-server.js</code> but the file has a different name.</p>
            
            <div class="warning-box">
                <strong>Common mismatches:</strong>
                <ul>
                    <li>File is named <code>server.js</code> instead of <code>ant-bridge-server.js</code></li>
                    <li>File is in a subdirectory like <code>src/ant-bridge-server.js</code></li>
                    <li>File has different capitalization</li>
                </ul>
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #3: Runtime Dependencies Missing</h3>
            <p>The app starts but crashes immediately due to missing dependencies.</p>
            
            <div class="code-block">
# Common runtime errors:
Error: Cannot find module 'ws'
Error: Cannot find module 'child_process'
Process exited with code 1
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Issue #4: Port Binding Problems</h3>
            <p>App starts but fails to bind to Railway's assigned port.</p>
            
            <div class="code-block">
# Runtime error examples:
Error: listen EADDRINUSE :::8888
Error: Port 8888 is already in use
EACCES: permission denied, listen on port 8888
            </div>
        </div>

        <h2>üõ†Ô∏è Debug Steps</h2>

        <div class="debug-section">
            <h3>Step 1: Check Railway Runtime Logs</h3>
            <p>In Railway dashboard:</p>
            <ol>
                <li>Go to your service (web-production-f8ebc)</li>
                <li>Click on the most recent deployment</li>
                <li>Look for <strong>"Deploy Logs"</strong> tab</li>
                <li>Scroll down to see <strong>runtime logs</strong> (after build)</li>
            </ol>
            
            <div class="warning-box">
                <strong>Look for:</strong> Error messages that appear AFTER "Successfully Built!"
            </div>
        </div>

        <div class="debug-section">
            <h3>Step 2: Verify File Structure</h3>
            <p>Check your GitHub repository has these files:</p>
            
            <div class="code-block">
repository-root/
‚îú‚îÄ‚îÄ ant-bridge-server.js  ‚Üê Main file (MUST exist)
‚îú‚îÄ‚îÄ package.json          ‚Üê With correct start script
‚îú‚îÄ‚îÄ Procfile              ‚Üê Optional: web: node ant-bridge-server.js
‚îî‚îÄ‚îÄ railway.json          ‚Üê Optional: Config file
            </div>
            
            <button class="btn" onclick="checkGitHubRepo()">üîç Check GitHub Repository</button>
        </div>

        <div class="debug-section">
            <h3>Step 3: Quick Fix - Create Minimal Server</h3>
            <p>If the file is missing, here's a minimal working server:</p>
            
            <div class="code-block">
// ant-bridge-server.js - Minimal Railway Test
const http = require('http');
const WebSocket = require('ws');

const port = process.env.PORT || 8888;

// Create HTTP server first
const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Railway ANT+ Bridge Server Running\\n');
});

// Create WebSocket server
const wss = new WebSocket.Server({ server });

wss.on('connection', (ws) => {
    console.log('Client connected');
    ws.send(JSON.stringify({
        type: 'status',
        message: 'Railway ANT+ Bridge Connected',
        platform: 'railway'
    }));
});

server.listen(port, '0.0.0.0', () => {
    console.log(`üöÇ Railway server running on port ${port}`);
});
            </div>
            
            <button class="btn" onclick="downloadMinimalServer()">üì• Download Minimal Server</button>
        </div>

        <div class="debug-section">
            <h3>Step 4: Test Connection</h3>
            <p>After fixing and redeploying, test the connection:</p>
            
            <button class="btn" onclick="testConnection()">üß™ Test Railway Connection</button>
            <div id="test-results"></div>
        </div>

        <div class="error-box">
            <h3>üö® Most Likely Issue</h3>
            <p><strong>Your <code>ant-bridge-server.js</code> file is missing from the GitHub repository.</strong></p>
            <p>Railway built successfully because it found <code>package.json</code>, but when it tries to start with <code>node ant-bridge-server.js</code>, the file doesn't exist.</p>
            
            <h4>Quick Fix:</h4>
            <ol>
                <li>Download the minimal server above</li>
                <li>Add it to your GitHub repository as <code>ant-bridge-server.js</code></li>
                <li>Commit and push to trigger redeploy</li>
            </ol>
        </div>

        <div class="warning-box">
            <h3>üìã Next Steps</h3>
            <ol>
                <li><strong>Check Railway deploy logs</strong> for runtime errors</li>
                <li><strong>Verify ant-bridge-server.js exists</strong> in your GitHub repo</li>
                <li><strong>Add minimal server</strong> if file is missing</li>
                <li><strong>Test connection</strong> after redeploy</li>
            </ol>
        </div>
    </div>

    <script>
        function checkGitHubRepo() {
            // Open GitHub repository in new tab
            const repoUrl = 'https://github.com/divergentinc2021/ANTicP';
            window.open(repoUrl, '_blank');
            
            alert('Check if ant-bridge-server.js exists in your repository root');
        }

        function downloadMinimalServer() {
            const serverCode = `// ant-bridge-server.js - Minimal Railway Server
const http = require('http');
const WebSocket = require('ws');

const port = process.env.PORT || 8888;

console.log('üöÇ Starting Railway ANT+ Bridge...');
console.log(\`Port: \${port}\`);

// Create HTTP server first (Railway needs this)
const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Railway ANT+ Bridge Server Running\\n' + new Date().toISOString());
});

// Create WebSocket server on the same port
const wss = new WebSocket.Server({ server });

console.log('WebSocket server created');

wss.on('connection', (ws, req) => {
    const clientIP = req.headers['x-forwarded-for'] || req.connection.remoteAddress;
    console.log(\`üîå Client connected from \${clientIP}\`);
    
    // Send welcome message
    ws.send(JSON.stringify({
        type: 'status',
        message: 'Connected to Railway ANT+ Bridge',
        platform: 'railway',
        timestamp: Date.now()
    }));
    
    // Handle messages
    ws.on('message', (data) => {
        try {
            const message = JSON.parse(data);
            console.log('üì® Received:', message.type);
            
            // Echo back with Railway info
            ws.send(JSON.stringify({
                type: 'response',
                original: message,
                platform: 'railway',
                status: 'received'
            }));
        } catch (error) {
            console.error('‚ùå Message error:', error);
        }
    });
    
    ws.on('close', () => {
        console.log('üîå Client disconnected');
    });
    
    ws.on('error', (error) => {
        console.error('‚ùå WebSocket error:', error);
    });
});

wss.on('error', (error) => {
    console.error('‚ùå WebSocket server error:', error);
});

// Start server
server.listen(port, '0.0.0.0', () => {
    console.log(\`‚úÖ Railway server running on port \${port}\`);
    console.log(\`üåê HTTP: http://0.0.0.0:\${port}\`);
    console.log(\`üîå WebSocket: ws://0.0.0.0:\${port}\`);
    console.log('üöÇ Railway deployment successful!');
});

// Handle Railway shutdown signals
process.on('SIGTERM', () => {
    console.log('üõë SIGTERM received, shutting down gracefully');
    server.close(() => {
        console.log('‚úÖ Server closed');
        process.exit(0);
    });
});

process.on('SIGINT', () => {
    console.log('üõë SIGINT received, shutting down gracefully');
    server.close(() => {
        console.log('‚úÖ Server closed');
        process.exit(0);
    });
});`;

            // Download the file
            const blob = new Blob([serverCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ant-bridge-server.js';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Downloaded minimal ant-bridge-server.js\\n\\nAdd this to your GitHub repository and push to trigger redeploy');
        }

        async function testConnection() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>üîç Testing Railway connection...</p>';

            try {
                // Test HTTP first
                const httpResponse = await fetch('https://web-production-f8ebc.up.railway.app', { 
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                // Test WebSocket
                const ws = new WebSocket('wss://web-production-f8ebc.up.railway.app');
                
                const timeout = setTimeout(() => {
                    ws.close();
                    resultsDiv.innerHTML = '<div style="background: #fff3cd; padding: 10px; border-radius: 5px;">‚ùå WebSocket timeout - Server may not be running</div>';
                }, 10000);

                ws.onopen = () => {
                    clearTimeout(timeout);
                    resultsDiv.innerHTML = '<div style="background: #d4edda; padding: 10px; border-radius: 5px;">‚úÖ Connection successful! Railway server is working</div>';
                    ws.close();
                };

                ws.onerror = () => {
                    clearTimeout(timeout);
                    resultsDiv.innerHTML = '<div style="background: #f8d7da; padding: 10px; border-radius: 5px;">‚ùå Connection failed - Check Railway deployment logs</div>';
                };

            } catch (error) {
                resultsDiv.innerHTML = `<div style="background: #f8d7da; padding: 10px; border-radius: 5px;">‚ùå Test failed: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
